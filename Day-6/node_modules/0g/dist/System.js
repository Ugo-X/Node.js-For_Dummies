export const allSystems = new Array();
function unregisteredSystem(filter, run, { phase = 'step', initialResult = undefined, } = {}) {
    function sys(game) {
        const query = game.queryManager.create(filter);
        let result;
        const entityResults = new WeakMap();
        function onPhase() {
            var _a;
            let ent;
            for (ent of query) {
                result = run(ent, game, (_a = entityResults.get(ent)) !== null && _a !== void 0 ? _a : initialResult);
                entityResults.set(ent, result);
            }
        }
        return game.subscribe(`phase:${phase}`, onPhase);
    }
    return sys;
}
export function system(filter, run, options) {
    const sys = unregisteredSystem(filter, run, options);
    allSystems.push(sys);
    return sys;
}
system.unregistered = unregisteredSystem;
/** @deprecated - use system */
export const makeSystem = system;
//# sourceMappingURL=System.js.map